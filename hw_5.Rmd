---
title: "Homework 5"
author: "Laura Lynch, LL3255"
date: "11/11/2019"
output: github_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(rvest)
library(stringr)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 10, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

# Problem 1
```{r}
# Load the data
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

### Function

Fill in missings in iris dataframe
```{r}
replace_iris = function(input_x) {
  
  # If null and numeric, replace with mean value for that column
  if(is.numeric(input_x)) {replace(input_x, is.na(input_x), mean(input_x,na.rm = TRUE))}
  
  # If null and character, replace with "virginica"
  else if(!is.numeric(input_x)) {replace(input_x, is.na(input_x), "virginica")}
  
}

# map it
complete_iris = map_df(iris_with_missing, ~ replace_iris(.x))

complete_iris
# Checks >> Sepal.Length Mean 5.819, Sepal.Width Mean 3.075, Petal.Length Mean 3.765, Petal.Width Mean 1.192 
# iris_with_missing
```


# Problem 2

### Tidy Dataframe
```{r}
# Dataframe containing all file names
df_read = list.files(path = "./data")

# Function to read in individual csv files

  csv_content =  data_frame(files =  df_read) %>%
  mutate(
    extract_data = map(files, ~read_csv(str_c("./data/", .x)))) %>% 
    #unnest to extrarct variables
  unnest(cols = extract_data) %>%
    #tidy weeks and obserrvations
    pivot_longer(
      cols = week_1:week_8,
      names_to = "week",
      values_to = "observation"
    ) %>%
    # subject ID
  mutate(subject_id = 
           files %>%
           str_extract("\\d{2}")) %>%
  # arm
  mutate(arm = 
           files %>%
           str_extract("[:lower:]{3}"))
```


### Spagetti Plot
```{r}
# Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.
csv_content %>% 
  group_by(subject_id) %>%
  ggplot(aes(x = week, y = observation, group = subject_id, color = arm)) +
  geom_path() + 
  labs(caption = "observations on each subject over time") + 
  viridis::scale_color_viridis(
    discrete = TRUE) + 
  theme(legend.position = "none")
```
• Differences between groups: 


# Problem 3

### Linear Regression Model ()
```{r}
# create function to draw the sample and calculate the y's
sim_data = tibble (
  beta0 = 2,
  beta1 = 0,
  x = rnorm(30),
  error = 50,
  y = beta0 + beta1*x + error
)

# create function to run regressions and output beta1_hat and p-value 
sim_regression = function(n, beta0, beta1) {
  
  sim_data = tibble(
    x = rnorm(n, 0, 1),
    y = beta0 + beta1 * x + rnorm(n, 0, 7.07)
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta1_hat = coef(ls_fit)[2]
  )
}

# get output from the function
output = vector("list", 100)

# run regressions
for (i in 1:100) {
  output[[i]] = sim_regression(30)
}
# clean the results from the iterration
sim_results = bind_rows(output)
# iterate
sim_results = 
  rerun(100, sim_regression(30, 2, 3)) %>% 
  bind_rows()

# visualize results
sim_results %>% 
  ggplot(aes(x = beta0_hat, y = beta1_hat)) + 
  geom_point()
# p-value?
#broom::tidy()
```


* Make a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of β2 on the x axis. Describe the association between effect size and power.
```{r}

```

* Make a plot showing the average estimate of β̂ 1 on the y axis and the true value of β1 on the x axis. Make a second plot (or overlay on the first) the average estimate of β̂ 1 only in samples for which the null was rejected on the y axis and the true value of β1 on the x axis. Is the sample average of β̂ 1 across tests for which the null is rejected approximately equal to the true value of β1? Why or why not?
```{r}

```

