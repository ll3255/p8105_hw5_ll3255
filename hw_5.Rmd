---
title: "Homework 5"
author: "Laura Lynch, LL3255"
date: "11/11/2019"
output: github_document
---

```{r setup, include=FALSE}

library(tidyverse)
library(rvest)
library(stringr)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 10, 
  fig.height = 6,
  out.width = "90%"
)
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d

theme_set(theme_minimal() + theme(legend.position = "bottom"))
```

# Problem 1
```{r}
# Load the data
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
```

### Function

Fill in missings in iris dataframe
```{r}
replace_iris = function(input_x) {
  
  # If null and numeric, replace with mean value for that column
  if(is.numeric(input_x)) {replace(input_x, is.na(input_x), mean(input_x,na.rm = TRUE))}
  
  # If null and character, replace with "virginica"
  else if(!is.numeric(input_x)) {replace(input_x, is.na(input_x), "virginica")}
  
}

# map it
complete_iris = map_df(iris_with_missing, ~ replace_iris(.x))

complete_iris
# Checks >> Sepal.Length Mean 5.819, Sepal.Width Mean 3.075, Petal.Length Mean 3.765, Petal.Width Mean 1.192 
# iris_with_missing
```


# Problem 2

### Tidy Dataframe
```{r}
# Dataframe containing all file names
df_read = list.files(path = "./data")

# Iterate over file names and read in data for each subject
tidy_function = function(input_x)  {

  # subject ID
  subject_id = input_x %>%
    str_extract("\\d{2}") 
  
  # arm
  arm = input_x %>%
    str_extract("[:lower:]{3}")
  

  # Extract week observation variables from csv
  df_extract = 
  # BREAKING HERE
    read_csv("./data") %>%
    pivot_longer(
      cols = week_1:week_8,
      names_to = "week",
      values_to = "observation"
    )
  
  # week
  week = df_extract %>%
    select(week)
  
  # observation
    observation = df_extract %>%
    select(observation)

 # Format new data frame 
 data_frame(arm, observation, week)
} 

# Map and saving the result as a new variable in the dataframe
tidy_subjects = map(df_read, ~ tidy_function(.x))

# save result as a new variable in the dataframe

# tidy the resulting dataframe
```
weather_nest =
  weather %>% 
  nest(data = date:tmin)

### Spagetti Plot (showing observations on each subject over time, and comment on differences between groups)

```{r}
# Make a spaghetti plot showing observations on each subject over time, and comment on differences between groups.
tidy_subjects %>% 
  ggplot(aes(x = week, y = observation, group = subject_id, color = subject_id)) +
  geom_path() + 
  labs(caption = "Subject scores over time") + 
  viridis::scale_color_viridis(
    discrete = TRUE) + 
  theme(legend.position = "none")
```


# Problem 3

### Linear Regression Model
```{r}
# create model
sim_regression = function(n, beta0 = 2) {
  
  sim_data = tibble(
    x = rnorm(n, mean = 1, sd = 1),
    y = beta0 * x + rnorm(n, 0, 1)
  )
  
  ls_fit = lm(y ~ x, data = sim_data)
  
  tibble(
    beta0_hat = coef(ls_fit)[1],
    beta1_hat = coef(ls_fit)[2]
  )
}

## rerun using a for loop
output = vector("list", length = 5000)
for (i in 1:5000) {
  
  output[[i]] = sim_regression(n = 30)
  
}

bind_rows(output) %>% 
  ggplot(aes(x = beta0_hat)) + geom_density()
```


* Make a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of β2 on the x axis. Describe the association between effect size and power.
```{r}

```

* Make a plot showing the average estimate of β̂ 1 on the y axis and the true value of β1 on the x axis. Make a second plot (or overlay on the first) the average estimate of β̂ 1 only in samples for which the null was rejected on the y axis and the true value of β1 on the x axis. Is the sample average of β̂ 1 across tests for which the null is rejected approximately equal to the true value of β1? Why or why not?
```{r}

```

